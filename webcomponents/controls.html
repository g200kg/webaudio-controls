<!--
/* *
 *
 *  WebAudio-Controls is based on
 *    webaudio-knob by Eiji Kitamura http://google.com/+agektmr
 *    webaudio-slider by RYoya Kawai https://plus.google.com/108242669191458983485/posts
 *    webaudio-switch by Keisuke Ai http://d.hatena.ne.jp/aike/
 *  Integrated and enhanced by g200kg http://www.g200kg.com/
 *
 *	Copyright 2013 Eiji Kitamura / Ryoya KAWAI / Keisuke Ai / g200kg(Tatsuya Shinyagaito)
 *
 *	 Licensed under the Apache License, Version 2.0 (the "License");
 *	 you may not use this file except in compliance with the License.
 *	 You may obtain a copy of the License at
 *
 *	 http://www.apache.org/licenses/LICENSE-2.0
 *
 *	 Unless required by applicable law or agreed to in writing, software
 *	 distributed under the License is distributed on an "AS IS" BASIS,
 *	 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *	 See the License for the specific language governing permissions and
 *	 limitations under the License.
 *
 * */
-->


<polymer-element name="webaudio-knob" attributes="value defvalue min max step sprites diameter width height sensitivity src valuetip tooltip enable" on-mousedown="pointerdown" on-touchstart="pointerdown" on-mouseover="pointerover" on-mouseout="pointerout">
	<template>
		<div class="wac-knob" id="wac-knob" touch-action="none">
			<span id="wac-value-tip">{{valuedisp}}</span>
			<div id="wac-tooltip-box"><span id="wac-tooltip-text">{{tooltip}}</span></div>
		</div>
		<style>
			@host {
				* {
					display: inline-block;
					font-family: sans-serif;
					font-size: 11px;
				}
			}
			#wac-knob {
				cursor: pointer;
				width: 64px;
				height: 64px;
				background-repeat: no-repeat;
				background-position: 0px 0px;
				position: relative;
			}
			#wac-value-tip {
				opacity: 0;
				border: solid 1px #666;
				background-color: #fff;
				color: #000;
				position: absolute;
				top: 0;
				right: 0;
				border-radius: 4px;
				padding: 3px 8px;
				transition: opacity 0.3s;
			}
			#wac-tooltip-box {
				position: absolute;
				width: 200px;
				bottom: -24px;
				left: 20px;
				z-index: 10;
			}
			#wac-tooltip-text {
				display: none;
				opacity: 0;
				border: solid 0px #666;
				background-color: #fff;
				color: #000;
				border-radius: 5px;
				padding: 5px;
				transition: opacity 0.5s;
			}
		</style>
	</template>
	<script>
		Polymer('webaudio-knob', (function() {
			var pointermove = function(e) {
				if(e.touches)
					e = e.touches[0];
				if(this.lastShift !== e.shiftKey) {
					this.lastShift = e.shiftKey;
					this.startPosX = e.pageX;
					this.startPosY = e.pageY;
					this.startVal = this.value;
				}
				var offset = (this.startPosY - e.pageY - this.startPosX + e.pageX) * this.sensitivity;
				this.setValue(this.min + ((((this.startVal + (this.max - this.min) * offset / ((e.shiftKey ? 4:1) * 128)) - this.min) / this.step)|0) * this.step);
				this.fire('change');
				e.preventDefault();
			};
			var cancel = function(e) {
				this.press = 0;
				this.startPosX = this.startPosY = null;
				this.$['wac-value-tip'].style.opacity = 0;
				window.removeEventListener('mousemove', this.boundPointermove, true);
				window.removeEventListener('touchmove', this.boundPointermove, true);
				window.removeEventListener('mouseup', this.boundCancel, true);
				window.removeEventListener('touchend', this.boundCancel, true);
				window.removeEventListener('touchcancel', this.boundCancel, true);
			};
			return {
			ready: function() {
				if(this.defvalue === null)
					this.defvalue = this.value;
				if(this.width === null)
					this.width = this.diameter;
				if(this.height === null)
					this.height = this.diameter;
				this.addEventListener('DOMMouseScroll',this.wheel.bind(this),false);
				this.addEventListener('mousewheel',this.wheel.bind(this),false);
				this.$['wac-knob'].style.width = this.width+'px';
				this.$['wac-knob'].style.height = this.height+'px';
				this.$['wac-knob'].style.background = 'url('+this.src+')';
				this.$['wac-knob'].style.backgroundSize = '100%'+((this.sprites+1)*100)+'%';
				if(this.step && this.step < 1) {
					for(var n = this.step ; n < 1; n *= 10)
						++this.digits;
				}
				this.setValue(this.value);
				this.fire('change');
			},
			value:      0,
			valuedisp:	"0",
			defvalue:   null,
			offset:     0,
			min:        0,
			max:        100,
			diameter:   64,
			width:      null,
			height:     null,
			step:       1,
			digits:     0,
			sprites:    30,
			enable:		1,
			src:        'data:image/png;base64,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',
			startPosX:  null,
			startPosY:  null,
			startVal:   0,
			sensitivity:1,
			valuetip:   1,
			press:		0,
			hover:		0,
			pointerdown: function(e) {
				if(!this.enable)
					return;
				if(e.touches)
					e = e.touches[0];
				if(e.ctrlKey) {
					this.setValue(parseFloat(this.defvalue));
					this.fire('change');
				}
				else {
					if(this.valuetip)
						this.$['wac-value-tip'].style.opacity = 0.8;
					this.startPosX = e.pageX;
					this.startPosY = e.pageY;
					this.startVal = this.value;
					this.boundPointermove = pointermove.bind(this);
					this.boundCancel = cancel.bind(this);
					window.addEventListener('mousemove', this.boundPointermove, true);
					window.addEventListener('touchmove', this.boundPointermove, true);
					window.addEventListener('mouseup', this.boundCancel, true);
					window.addEventListener('touchend', this.boundCancel, true);
					window.addEventListener('touchcancel', this.boundCancel, true);
				}
				this.press = 1;
				this.showtooltip();
				e.preventDefault();
			},
			pointerover: function(e) {
				this.hover = 1;
				setTimeout(this.showtooltip.bind(this),700);
			},
			pointerout: function(e) {
				this.hover = 0;
				this.showtooltip();
			},
			wheel: function(e) {
				var delta = 0;
				if(!e)
					e = window.event;
				if(e.wheelDelta)
					delta = e.wheelDelta/120;
				else if(e.detail)
					delta = -e.detail/3;
				if(e.shiftKey)
					delta *= 0.2;
				delta *= (this.max - this.min) * 0.05;
				if(Math.abs(delta) < this.step)
					delta = (delta>0)?this.step:-this.step;
				this.setValue(this.value+delta);
				this.fire('change');
				e.preventDefault();
			},
			showtooltip: function() {
				if(this.tooltip && this.hover && !this.press) {
					this.$['wac-tooltip-text'].style.display = 'inline-block';
					this.$['wac-tooltip-text'].style.opacity = 0.8;
				}
				else {
					this.$['wac-tooltip-text'].style.display = 'none';
					this.$['wac-tooltip-text'].style.opacity = 0;
				}
			},
			setValue: function(value) {
				this.value = value < this.min ? this.min : value > this.max ? this.max : value;
				this.valuedisp = this.value.toFixed(this.digits);
				var range = this.max - this.min;
				var offset = ~~(this.sprites * (this.value - this.min) / range) * this.height;
				this.$['wac-knob'].style.backgroundPosition= "0px -" + offset + "px";
			}
		};
	})());
	</script>
</polymer-element>


<polymer-element name="webaudio-slider" attributes="min max value defvalue step width height knobwidth knobheight ditchLength src knobsrc direction valuetip sensitivity tooltip enable" on-mousedown="pointerdown" on-touchstart="pointerdown" on-mouseover="pointerover" on-mouseout="pointerout">
	<template>
		<div class="wac-slibase" id="wac-slibase" touch-action="none">
			<div class="wac-sliknob" id="wac-sliknob"></div>
			<span id="wac-value-tip">{{valuedisp}}</span>
			<div id="wac-tooltip-box"><span id="wac-tooltip-text">{{tooltip}}</span></div>
		</div>
		<style>
			@host {
				* {
					display: inline-block;
					font-family: sans-serif;
					font-size: 11px;
				}
			}
			#wac-slibase {
				background: #000000;
				position: relative;
			}
			#wac-sliknob {
				cursor: pointer;
				background: #ff0000;
				position: relative;
			}
			#wac-value-tip {
				opacity: 0;
				border: solid 1px #666;
				background-color: #fff;
				color: #000;
				position: absolute;
				top: 0;
				right: 0;
				border-radius: 3px;
				padding: 3px 8px;
				transition: opacity 0.3s;
			}
			#wac-tooltip-box {
				position: absolute;
				width: 200px;
				bottom: -24px;
				left: 20px;
				z-index: 10;
			}
			#wac-tooltip-text {
				display: none;
				opacity: 0;
				border: solid 0px #666;
				background-color: #fff;
				color: #000;
				border-radius: 5px;
				padding: 5px;
				transition: opacity 0.5s;
			}
		</style>
	</template>
	<script>
		Polymer('webaudio-slider', (function() {
			var pointermove = function(e) {
				if(e.touches)
					e = e.touches[0];
				if(this.lastShift !== e.shiftKey) {
					this.lastShift = e.shiftKey;
					this.startPosX = e.pageX;
					this.startPosY = e.pageY;
					this.startVal = this.value;
				}
				if(this.direction == 'vert')
					var offset = (this.startPosY - e.pageY) / this.ditchLength;
				else
					var offset = (e.pageX - this.startPosX) / this.ditchLength;
				this.setValue(this.min + ((((this.startVal + (this.max - this.min) * offset * this.sensitivity / ((e.shiftKey ? 4:1))) - this.min) / this.step)|0) * this.step);
				this.fire('change');
				e.preventDefault();
			};
			var cancel = function(e) {
				this.press = 0;
				this.startPosX = this.startPosY = null;
				this.$['wac-value-tip'].style.opacity = 0;
				window.removeEventListener('mousemove', this.boundPointermove, true);
				window.removeEventListener('touchmove', this.boundPointermove, true);
				window.removeEventListener('mouseup', this.boundCancel, true);
				window.removeEventListener('touchend', this.boundCancel, true);
				window.removeEventListener('touchcancel', this.boundCancel, true);
			};
			return {
			ready: function() {
				if(this.defvalue === null)
					this.defvalue = this.value;
				if(this.width == 0)
					this.width = (this.direction == 'vert' ? 24 : 128);
				if(this.height == 0)
					this.height = (this.direction == 'vert' ? 128 : 24);
				if(this.knobwidth == 0)
					this.knobwidth = (this.direction == 'vert' ? this.width : this.height);
				if(this.knobheight == 0)
					this.knobheight = (this.direction == 'vert' ? this.width : this.height);
				if(this.ditchLength == 0)
					this.ditchLength = (this.direction =='vert' ? this.height - this.knobheight : this.width - this.knobwidth);
				this.addEventListener('DOMMouseScroll',this.wheel.bind(this),false);
				this.addEventListener('mousewheel',this.wheel.bind(this),false);
				this.$['wac-slibase'].style.width = this.width+'px';
				this.$['wac-slibase'].style.height = this.height+'px';
				if(this.src)
					this.$['wac-slibase'].style.background = 'url('+this.src+')';
				this.$['wac-slibase'].style.backgroundSize = '100% 100%';
				this.$['wac-sliknob'].style.width = this.knobwidth+'px';
				this.$['wac-sliknob'].style.height = this.knobheight+'px';
				this.$['wac-sliknob'].style.background = 'url('+this.knobsrc+')';
				this.$['wac-sliknob'].style.left = this.width/2 - this.knobwidth/2 + "px";
				this.$['wac-sliknob'].style.top = this.height/2 - this.knobheight/2 + "px";
				this.$['wac-sliknob'].style.backgroundSize = '100% 100%';
				if(this.step && this.step < 1) {
					for(var n = this.step ; n < 1; n *= 10)
						++this.digits;
				}
				this.setValue(this.value);
				this.fire('change');
			},
			min:			0,
			max:			100,
			value:			0,
			valuedisp:		"0",
			defvalue:		null,
			step:			1,
			width:			0,
			height:			0,
			knobwidth:		0,
			knobheight:		0,
			ditchLength:	0,
			src:			'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAxUlEQVR42u3b0QmDMBQF0KygS3QYpxEncpxM1b5CAlZbKPSreSdwB7hHSb5uKe/PHFkia+T+51lbl7l8cabIFqkDFD+ntm7Tp/K3yD5g8XP21vXy5TOUPyK8/AlbovI92/HCqwkBar8Yl4Tle57dh3jqfnki05bvAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEYESD+YSD+ZST+aSj+bM5w0nTWevpw08/kHlO6byrGkuCkAAAAASUVORK5CYII=',
			knobsrc:		'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAEDElEQVR42u1XS0hVURQ9+YsUQxNrJloTwYEjcSbiSISIhGjWsLlIOBNHDgUDhw6CCJOwSEokwoQokTApTE1CNHnlJ7+Z/7da675z9fC67z4/NQh8sPB371lrr73P3ltjTj//0wfGnPtlTO2aMXdXjelfNubzD2KO33/j72b5Nz3zt0lTNo25smVMI7FCYIP4SVAEKAKLBEUgQkzxmUk+O8139O5JybN3jbm5Y8x7AnvE7pkz2CY2iXVi1QpYIL4TXwkKwATf+cR353nGccnzSdhKLIg4mpqK6NmzQHY2oufPYy8rC7v8eZ2/X6IQX0DkQABG+e4Iz2B68o8cuSXfiPJwjzgvDygsBIqLY7h8GcjPxx4FraWn4wefcwV8iQnAMM8gWg/thPIm2xW5yMFIUVAAlJcDV68CN24A164BlZVASQmiFy9iOzMTS3TCTYEv4APxjme95ZmHqgkVnHLu2a7IRV5VBdy+DTQ1Ac3NQEMDcOsWUFHhObGTm4sluhBXA64AvOGZH3l2UgGq9h2bc892RS7y1lagszOGtjagrg6orvbSscPnljMyMEvH4gUMHwjAK56d9J7rqu1Hr5zLdkUu4r4+oLcXaG8H7twBamo8AdsXLmCRAmYoYMraP06MOAJeEy95dmifUJPZsldN1e4Vm3Iu2yVA5F1dQEtLzBXWQbSoCJu8FXNpaYH2DxGDVsCL2NfahALU4dRkdM911TwBKjjlXLYrcpHX1wPXrwOlpdi7dAkrLMLvKSn70U/ERT9A9FsBT8mRUIDaqzqcmozuuXfVVO0qOOVctitykZeVeQW6QadmWYDTfCcoej//fQcC+hMKUG9XZ1OHU5PRPddV86pdBaecSxAjF/lmTg7m+dyMJQ/K/cBB/tFDPCZHQgEaLMu2x6vDqcnonntO2AaknMt2RS7yCK2fdKwPit63/xnxKEyAptqi7e1qr+pwajK657pqqnYVnHIu293IXfKg6HuJJ0RnWAo0UufsYBHUXtXh1GR0z3XVVO0quOkActf6wbjcK/ou4kFYEWqeR+xQiYeazIxtNFNOuw0j961X7rtj0ev72tBGpHn+1Q6ViG2tPuKJxwNsd8l967tjuVf0K0kXFi0Tk5YoHj6xG3UYuWt9RwyNSWeBNhktExOW0CUdDyAeSkJuCw/3eebzwwwjjUxtMlomRi3haAixX+1h5LR+4R7PbDrsiqblQZuMlokPDmki4tdOtff+Sb7xkGeNHXU10xqlTUbLxDuHdDCO2I3ar/YuJ3KRDx11JXOd0CajZcIn9En7HGI/ar/aO2zOZfvYcZdStya0yWiZ0Dx/YUn9iH27nahXVO0quKaTruVBfULzXCNVU02DRb1d7VUdrudf/GNy+vnXn98GjC4Yymnd5wAAAABJRU5ErkJggg==',
			startPosX:		null,
			startPosY:		null,
			startVal:		0,
			sensitivity:	1,
			direction:		'vert',
			valuetip:     	1,
			digits:			0,
			enable:			1,
			press:			0,
			hover:			0,
			pointerdown: function(e) {
				if(!this.enable)
					return;
				if(e.touches)
					e = e.touches[0];
				if(e.ctrlKey) {
					this.setValue(this.defvalue);
					this.fire('change');
				}
				else {
					if(this.valuetip)
						this.$['wac-value-tip'].style.opacity = 0.8;
					this.startPosX = e.pageX;
					this.startPosY = e.pageY;
					this.startVal = this.value;
					this.boundPointermove = pointermove.bind(this);
					this.boundCancel = cancel.bind(this);
					window.addEventListener('mousemove', this.boundPointermove, true);
					window.addEventListener('touchmove', this.boundPointermove, true);
					window.addEventListener('mouseup', this.boundCancel, true);
					window.addEventListener('touchend', this.boundCancel, true);
					window.addEventListener('touchcancel', this.boundCancel, true);
				}
				this.press = 1;
				this.showtooltip();
				e.preventDefault();
			},
			pointerover: function(e) {
				this.hover = 1;
				setTimeout(this.showtooltip.bind(this),700);
			},
			pointerout: function(e) {
				this.hover = 0;
				this.showtooltip();
			},
			showtooltip: function() {
				if(this.tooltip && this.hover && !this.press) {
					this.$['wac-tooltip-text'].style.display = 'inline-block';
					this.$['wac-tooltip-text'].style.opacity = 0.8;
				}
				else {
					this.$['wac-tooltip-text'].style.display = 'none';
					this.$['wac-tooltip-text'].style.opacity = 0;
				}
			},
			wheel: function(e) {
				var delta = 0;
				if(!e)
					e = window.event;
				if(e.wheelDelta)
					delta = e.wheelDelta/120;
				else if(e.detail)
					delta = -e.detail/3;
				if(e.shiftKey)
					delta *= 0.2;
				delta *= (this.max - this.min) * 0.05;
				if(Math.abs(delta) < this.step)
					delta = (delta>0)?this.step:-this.step;
				this.setValue(this.value+delta);
				this.fire('change');
				e.preventDefault();
			},
			setValue: function(value) {
				this.value = value < this.min ? this.min : value > this.max ? this.max : value;
				var range = Math.abs(this.min) + Math.abs(this.max);
				if(this.direction == 'vert') {
					var value = this.ditchLength+(this.height-this.ditchLength)/2 - this.value * (this.ditchLength/this.max);
					this.$['wac-sliknob'].style.top = value-this.knobheight/2 + "px";
				}
				else {
					var value = (this.width-this.ditchLength)/2 + this.value * (this.ditchLength/this.max);
					this.$['wac-sliknob'].style.left = value-this.knobwidth/2+"px";
				}
				this.valuedisp = this.value.toFixed(this.digits);
			}
		};
	})());
	</script>
</polymer-element>

<polymer-element name="webaudio-switch" attributes="value defvalue type width height src group tooltip enable" on-mousedown="pointerdown" on-touchstart="pointerdown" on-mouseover="pointerover" on-mouseout="pointerout">
	<template>
		<div class="wac-switch" id="wac-switch">
			<div id="wac-tooltip-box"><span id="wac-tooltip-text">{{tooltip}}</span></div>
		</div>
		<style>
			@host {
				* {
					display: inline-block;
					font-family: sans-serif;
					font-size: 11px;
				}
			}
			#wac-switch {
				cursor: pointer;
				width: 64px;
				height: 64px;
				background-position: -64px;
				position: relative;
			}
			#wac-tooltip-box {
				position: absolute;
				width: 200px;
				bottom: -24px;
				left: 20px;
				z-index: 10;
			}
			#wac-tooltip-text {
				display: none;
				opacity: 0;
				border: solid 0px #666;
				background-color: #fff;
				color: #000;
				border-radius: 5px;
				padding: 5px;
				transition: opacity 0.5s;
			}
		</style>
	</template>
	<script>
		Polymer('webaudio-switch', (function() {
			var cancel = function(e) {
				window.removeEventListener('mouseup', this.boundUp, true);
				window.removeEventListener('touchend', this.boundUp, true);
				window.removeEventListener('touchcancel', this.boundCancel, true);
				if(this.type=="kick")
					this.setValue(0);
				this.press = 0;
			};
			var up = function(e) {
				window.removeEventListener('mouseup', this.boundUp, true);
				window.removeEventListener('touchend', this.boundUp, true);
				window.removeEventListener('touchcancel', this.boundCancel, true);
				if(this.type=="kick") {
					this.setValue(0);
					if(this.value)
						this.fire('click');
				}
				this.press = 0;
			};
			return {
			ready: function() {
				this.$['wac-switch'].style.width = this.width+'px';
				this.$['wac-switch'].style.height = this.height+'px';
				this.$['wac-switch'].style.background = 'url('+this.src+')';
				this.$['wac-switch'].style.backgroundPosition = '0px -' + (this.value * this.height) + 'px';
				this.$['wac-switch'].style.backgroundSize = '100% 200%';
				if(this.defvalue === null)
					this.defvalue = this.value;
			},
			value:			0,
			defvalue:		null,
			type:			'toggle',
			width:			24,
			height:			24,
			src: 			'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAABACAYAAAB7jnWuAAADiklEQVR42u2YzUtUURjG1Rn8mEHEhV+DK3E3q0EGXAq5EkLETYG4cOlioJWI6NqWLUTnH3ARUpJJyRQVWYqEWSAlJmRBkn0gIqTFnLfnvb5XTuOdr3Pv0Fhz4bfwznif5/06c+4pKyuyywfqQBhEPSYsz/alE68BnWACvAekoVL+zhclz5wQjRqnyPmDeXDosbjOoWh0pmaiTtwdphH22sSEaJ5dYYe055oFladpuxxh3UA0w4NVDvVNdz/TM6LZDBSatAaURz2gsjzTOAPK8LOClcC0R4q3B8ijFLs2oAyaLB/jeWUgl1nPN4Di7wFluAT/O1PgZRNenAwolyug50txLmX4a0vx/zsFKiX9Kofdk3JrQHm4V3Q04GZTavI/5zalTtvyQuG4Lc/2YqIMdr1O2Uj7YpLp1Ux5tBRnfDUripfT0lU6HyidD1yM8wE/uATGQRzMgFHQJZ8V7HygFsQArNMJ+AGQSzoAX8EnsAaGQNDr84EQ2ARJpqKCyO+nJDj2+SwT38E++Ah2wCJoyZ7N3DIQkoeq8nKiYJAoFCJqazuloYF+BgJ0AFO2gXdgS0w0u92U1krklnh9PVEkQtTXRzQ4SNTbS9TRQaqxkY4qK88Z2AA3QcCNgZik3YqcxYeHiaamiOJxorExop4eKxPHyMJnmLRLYBtYBVdNDfil4ayac9o5chZPJIgWF4kmJ0/vtbfTEQzuwcCuZOCNGFgBc+enIzcD3dLt3HBWvTntHDmLz84SjYwQdXdTsrWVvlVVnUX/FrwGL8Az8BBETQyMy6glbQNcc047R87i/f1E4TCdoDf28Z1dMWBHzwaWQQIMmBiIy5zzqHG3c8NZNee0I3IW/4X7XxD9rlb7V2Bd6v8YLIFrJgZmZJFhEzxq3O1WJlBzTjtHzuIfUHsW35aJealF/0DGMWZiYFRWOF5keM551LjbueG45nratyX1du05+keSfvz00RUTA12yvO5r8KjtybilE1/Ran9XpiBiOoZrsrjo2MJ2zTc1cf7+U+n8e+A2mM5zDP/41RrSxHZShO2oN7S0L4s4N96CrISX3ayEQWmiLQ1deN1B/L4mfh1Uuz2iaRETG5qoLvxcazhO+x0RvwGavDofaJaHrmqiHPETiTohJm9pkTd5fT4QkB+WOU10SYTn5f601Ly6kOcDflnbB2SFi8mcR5y3ZKXzgdL5QOl8IOv1G6BBOS3D5b9NAAAAAElFTkSuQmCC',
			enable:			1,
			group:			'',
			tooltip: 		'',
			press:			0,
			hover:			0,
			pointerdown: function(e) {
				if(!this.enable)
					return;
				this.boundCancel = cancel.bind(this);
				this.boundUp = up.bind(this);
				window.addEventListener('mouseup', this.boundUp, true);
				window.addEventListener('touchend', this.boundUp, true);
				window.addEventListener('touchcancel', this.boundCancel, true);
				switch(this.type) {
				case 'kick':
					this.setValue(1);
					break;
				case 'toggle':
					if(e.ctrlKey)
						this.setValue(this.defvalue);
					else
						this.setValue(1 - this.value);
					break;
				case 'radio':
					this.setValue(1);
					break;
				}
				this.fire('change');
				this.press = 1;
				this.showtooltip();
				e.preventDefault();
			},
			pointerover: function(e) {
				this.hover = 1;
				setTimeout(this.showtooltip.bind(this),700);
				if(this.type=="kick"&&this.press)
					this.setValue(1);
			},
			pointerout: function(e) {
				this.hover = 0;
				this.showtooltip();
				if(this.type=="kick")
					this.setValue(0);
			},
			showtooltip: function() {
				if(this.tooltip && this.hover && !this.press) {
					this.$['wac-tooltip-text'].style.display = 'inline-block';
					this.$['wac-tooltip-text'].style.opacity = 0.8;
				}
				else {
					this.$['wac-tooltip-text'].style.display = 'none';
					this.$['wac-tooltip-text'].style.opacity = 0;
				}
			},
			setValue: function(value) {
				this.value = parseInt(value);
				this.valuedisp = this.value;
				this.$['wac-switch'].style.backgroundPosition = '0px -' + (this.value * this.height) + 'px';
				var el = document.getElementsByTagName('webaudio-switch');
				if(value == 1) {
					for(var i = 0, j = el.length; i < j; ++i) {
						if(this.group && el[i] != this && el[i].group == this.group)
							el[i].setValue(0);
					}
				}
			}
		};
	})());
	</script>
</polymer-element>

<polymer-element name="webaudio-param" attributes="value width height fontsize color src link">
	<template>
		<input type="text" class="param" id="param" value="0"/>
		<style>
			@host {
				* {
					display: inline-block;
					font-family: sans-serif;
				}
			}
			#param {
				border: none;
				cursor: pointer;
				text-align: center;
				position: relative;
			}
		</style>
	</template>
	<script>
		Polymer('webaudio-param', (function() {
			var change = function(e) {
				if(e.target)
					e = e.target;
				var f = eval(this.fconv);
				var t = typeof(f);
				if(this.fconv == null)
					this.$['param'].value = e.valuedisp;
				else if(t == "object")
					this.$['param'].value = f[e.value];
				else if(t == "function")
					this.$['param'].value = f(e.value);
			};
			var edit = function(e) {
				document.getElementById(this.link).setValue(parseFloat(this.$['param'].value));
			}
			return {
				ready: function() {
					this.$['param'].style.width = this.width+'px';
					this.$['param'].style.height = this.height+'px';
					this.$['param'].style.background = 'url('+this.src+')';
					this.$['param'].style.backgroundSize = '100% 100%';
					this.$['param'].style.color = this.color;
					this.$['param'].style.fontSize = this.fontsize+'px';
					this.boundChange = change.bind(this);
					this.boundEdit = edit.bind(this);
					if(this.link) {
						var t = document.getElementById(this.link);
						t.addEventListener("change", this.boundChange, true);
						this.boundChange(t);
					}
					this.$['param'].addEventListener("change", this.boundEdit, true);
				},
				value:			0,
				width:			32,
				height:			16,
				fontsize:		9,
				src:			'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAxUlEQVR42u3b0QmDMBQF0KygS3QYpxEncpxM1b5CAlZbKPSreSdwB7hHSb5uKe/PHFkia+T+51lbl7l8cabIFqkDFD+ntm7Tp/K3yD5g8XP21vXy5TOUPyK8/AlbovI92/HCqwkBar8Yl4Tle57dh3jqfnki05bvAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEYESD+YSD+ZST+aSj+bM5w0nTWevpw08/kHlO6byrGkuCkAAAAASUVORK5CYII=',
				color:			'#ffffff',
				link:			null,
				fconv:			null
			};
		})());
	</script>
</polymer-element>
